import React, { useState, useCallback } from 'react';\nimport { ProcessingData } from '../App';\n\ninterface FileImportProps {\n  onStartProcessing: (data: ProcessingData) => void;\n  onError: (error: string) => void;\n}\n\nexport function FileImport({ onStartProcessing, onError }: FileImportProps) {\n  const [importMode, setImportMode] = useState<'xml' | 'files'>('xml');\n  const [xmlPath, setXmlPath] = useState<string>('');\n  const [audioPath, setAudioPath] = useState<string>('');\n  const [videoPath, setVideoPath] = useState<string>('');\n  const [dragOver, setDragOver] = useState(false);\n  \n  /**\n   * XMLãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ\n   */\n  const selectXMLFile = useCallback(async () => {\n    try {\n      const result = await window.electronAPI.dialog.selectFile({\n        title: 'Select Premiere XML Project',\n        filters: [\n          { name: 'XML Files', extensions: ['xml'] },\n          { name: 'All Files', extensions: ['*'] },\n        ],\n      });\n      \n      if (!result.canceled && result.filePaths?.[0]) {\n        setXmlPath(result.filePaths[0]);\n      }\n    } catch (error) {\n      onError(`Failed to select XML file: ${error}`);\n    }\n  }, [onError]);\n  \n  /**\n   * ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ\n   */\n  const selectAudioFile = useCallback(async () => {\n    try {\n      const result = await window.electronAPI.dialog.selectFile({\n        title: 'Select Audio File',\n        filters: [\n          { name: 'Audio Files', extensions: ['mp3', 'wav', 'aac', 'm4a', 'flac'] },\n          { name: 'All Files', extensions: ['*'] },\n        ],\n      });\n      \n      if (!result.canceled && result.filePaths?.[0]) {\n        setAudioPath(result.filePaths[0]);\n      }\n    } catch (error) {\n      onError(`Failed to select audio file: ${error}`);\n    }\n  }, [onError]);\n  \n  /**\n   * ãƒ“ãƒ‡ã‚ªãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ\n   */\n  const selectVideoFile = useCallback(async () => {\n    try {\n      const result = await window.electronAPI.dialog.selectFile({\n        title: 'Select Video File',\n        filters: [\n          { name: 'Video Files', extensions: ['mp4', 'mov', 'avi', 'mkv', 'webm'] },\n          { name: 'All Files', extensions: ['*'] },\n        ],\n      });\n      \n      if (!result.canceled && result.filePaths?.[0]) {\n        setVideoPath(result.filePaths[0]);\n      }\n    } catch (error) {\n      onError(`Failed to select video file: ${error}`);\n    }\n  }, [onError]);\n  \n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‰ãƒ­ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n   */\n  const handleDrop = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    setDragOver(false);\n    \n    const files = Array.from(event.dataTransfer.files);\n    if (files.length === 0) return;\n    \n    const file = files[0];\n    const extension = file.name.split('.').pop()?.toLowerCase();\n    \n    if (extension === 'xml') {\n      setXmlPath(file.path);\n      setImportMode('xml');\n    } else if (['mp3', 'wav', 'aac', 'm4a', 'flac'].includes(extension || '')) {\n      setAudioPath(file.path);\n      setImportMode('files');\n    } else if (['mp4', 'mov', 'avi', 'mkv', 'webm'].includes(extension || '')) {\n      setVideoPath(file.path);\n      setImportMode('files');\n    } else {\n      onError(`Unsupported file type: ${extension}`);\n    }\n  }, [onError]);\n  \n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n   */\n  const handleDragOver = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    setDragOver(true);\n  }, []);\n  \n  /**\n   * ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–ãƒãƒ³ãƒ‰ãƒ©ãƒ¼\n   */\n  const handleDragLeave = useCallback((event: React.DragEvent) => {\n    event.preventDefault();\n    setDragOver(false);\n  }, []);\n  \n  /**\n   * å‡¦ç†é–‹å§‹\n   */\n  const handleStartProcessing = useCallback(() => {\n    if (importMode === 'xml') {\n      if (!xmlPath) {\n        onError('Please select an XML file');\n        return;\n      }\n      onStartProcessing({\n        type: 'xml',\n        xmlPath,\n      });\n    } else {\n      if (!audioPath || !videoPath) {\n        onError('Please select both audio and video files');\n        return;\n      }\n      onStartProcessing({\n        type: 'files',\n        audioPath,\n        videoPath,\n      });\n    }\n  }, [importMode, xmlPath, audioPath, videoPath, onStartProcessing, onError]);\n  \n  /**\n   * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’çŸ­ç¸®\n   */\n  const truncatePath = (path: string, maxLength: number = 50) => {\n    if (path.length <= maxLength) return path;\n    return '...' + path.slice(path.length - maxLength + 3);\n  };\n  \n  /**\n   * å‡¦ç†å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯\n   */\n  const canStartProcessing = () => {\n    if (importMode === 'xml') {\n      return xmlPath.length > 0;\n    } else {\n      return audioPath.length > 0 && videoPath.length > 0;\n    }\n  };\n  \n  return (\n    <div className=\"file-import\">\n      <div className=\"file-import-header\">\n        <h1>AutoEditTATE</h1>\n        <p>AI-powered automatic video editing for SNS content</p>\n      </div>\n      \n      {/* ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰é¸æŠ */}\n      <div className=\"import-mode-selector\">\n        <button \n          className={`mode-button ${importMode === 'xml' ? 'active' : ''}`}\n          onClick={() => setImportMode('xml')}\n        >\n          <span className=\"mode-icon\">ğŸ“„</span>\n          <span className=\"mode-title\">XML Project</span>\n          <span className=\"mode-desc\">Import Premiere Pro XML</span>\n        </button>\n        \n        <button \n          className={`mode-button ${importMode === 'files' ? 'active' : ''}`}\n          onClick={() => setImportMode('files')}\n        >\n          <span className=\"mode-icon\">ğŸ¬</span>\n          <span className=\"mode-title\">Audio + Video</span>\n          <span className=\"mode-desc\">Import separate files</span>\n        </button>\n      </div>\n      \n      {/* ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒªã‚¢ */}\n      <div \n        className={`file-drop-area ${dragOver ? 'drag-over' : ''}`}\n        onDrop={handleDrop}\n        onDragOver={handleDragOver}\n        onDragLeave={handleDragLeave}\n      >\n        {importMode === 'xml' ? (\n          <div className=\"xml-import\">\n            <div className=\"drop-area-content\">\n              <span className=\"drop-icon\">ğŸ“„</span>\n              <h3>Drop XML file here or click to browse</h3>\n              <p>Supported: .xml files</p>\n            </div>\n            \n            {xmlPath && (\n              <div className=\"selected-file\">\n                <span className=\"file-icon\">ğŸ“„</span>\n                <span className=\"file-path\" title={xmlPath}>\n                  {truncatePath(xmlPath)}\n                </span>\n                <button \n                  className=\"remove-file\"\n                  onClick={() => setXmlPath('')}\n                  title=\"Remove file\"\n                >\n                  âœ•\n                </button>\n              </div>\n            )}\n            \n            <button \n              className=\"browse-button\"\n              onClick={selectXMLFile}\n            >\n              Browse XML Files\n            </button>\n          </div>\n        ) : (\n          <div className=\"files-import\">\n            <div className=\"drop-area-content\">\n              <span className=\"drop-icon\">ğŸ¬</span>\n              <h3>Drop audio and video files here</h3>\n              <p>Supported: MP3, WAV, MP4, MOV, etc.</p>\n            </div>\n            \n            <div className=\"file-inputs\">\n              {/* ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ•ã‚¡ã‚¤ãƒ« */}\n              <div className=\"file-input-group\">\n                <label>Audio File</label>\n                {audioPath ? (\n                  <div className=\"selected-file\">\n                    <span className=\"file-icon\">ğŸµ</span>\n                    <span className=\"file-path\" title={audioPath}>\n                      {truncatePath(audioPath)}\n                    </span>\n                    <button \n                      className=\"remove-file\"\n                      onClick={() => setAudioPath('')}\n                      title=\"Remove file\"\n                    >\n                      âœ•\n                    </button>\n                  </div>\n                ) : (\n                  <button \n                    className=\"file-select-button\"\n                    onClick={selectAudioFile}\n                  >\n                    <span className=\"file-icon\">ğŸµ</span>\n                    Select Audio File\n                  </button>\n                )}\n              </div>\n              \n              {/* ãƒ“ãƒ‡ã‚ªãƒ•ã‚¡ã‚¤ãƒ« */}\n              <div className=\"file-input-group\">\n                <label>Video File</label>\n                {videoPath ? (\n                  <div className=\"selected-file\">\n                    <span className=\"file-icon\">ğŸ¬</span>\n                    <span className=\"file-path\" title={videoPath}>\n                      {truncatePath(videoPath)}\n                    </span>\n                    <button \n                      className=\"remove-file\"\n                      onClick={() => setVideoPath('')}\n                      title=\"Remove file\"\n                    >\n                      âœ•\n                    </button>\n                  </div>\n                ) : (\n                  <button \n                    className=\"file-select-button\"\n                    onClick={selectVideoFile}\n                  >\n                    <span className=\"file-icon\">ğŸ¬</span>\n                    Select Video File\n                  </button>\n                )}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n      \n      {/* å‡¦ç†é–‹å§‹ãƒœã‚¿ãƒ³ */}\n      <div className=\"action-buttons\">\n        <button \n          className={`start-button ${canStartProcessing() ? 'enabled' : 'disabled'}`}\n          onClick={handleStartProcessing}\n          disabled={!canStartProcessing()}\n        >\n          <span className=\"button-icon\">â–¶ï¸</span>\n          Start Processing\n        </button>\n      </div>\n      \n      {/* ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ */}\n      <div className=\"help-text\">\n        <h4>Quick Guide:</h4>\n        <ul>\n          <li><strong>XML Mode:</strong> Import a Premiere Pro XML project with video and audio materials</li>\n          <li><strong>Files Mode:</strong> Import separate audio and video files for analysis</li>\n          <li><strong>Processing:</strong> AutoEditTATE will analyze content and generate 3 editing patterns</li>\n          <li><strong>Output:</strong> Get XML timeline, explain.json, and QA report</li>\n        </ul>\n      </div>\n    </div>\n  );\n}