import React, { useState, useEffect } from 'react';\nimport { ProcessingResult } from '../App';\n\ninterface ResultsViewProps {\n  result: ProcessingResult | null;\n  onReset: () => void;\n  onRetry: () => void;\n}\n\ninterface QAMetrics {\n  aggregateConfidence: number;\n  musicSync: number;\n  visualFlow: number;\n  thirtyPercentCompliance: number;\n  overallScore: number;\n}\n\nexport function ResultsView({ result, onReset, onRetry }: ResultsViewProps) {\n  const [selectedPattern, setSelectedPattern] = useState<string>('recommended');\n  const [showDetails, setShowDetails] = useState<string | null>(null);\n  const [exportProgress, setExportProgress] = useState<number>(0);\n  const [isExporting, setIsExporting] = useState<boolean>(false);\n  \n  useEffect(() => {\n    if (result?.success && result.result) {\n      setSelectedPattern(result.result.recommendedPattern || 'hybrid_balance');\n    }\n  }, [result]);\n  \n  if (!result) {\n    return (\n      <div className=\"results-view error\">\n        <h2>No Results Available</h2>\n        <p>Something went wrong during processing.</p>\n        <button onClick={onReset}>Start Over</button>\n      </div>\n    );\n  }\n  \n  if (!result.success) {\n    return (\n      <div className=\"results-view error\">\n        <div className=\"error-header\">\n          <span className=\"error-icon\">‚ùå</span>\n          <h2>Processing Failed</h2>\n        </div>\n        \n        <div className=\"error-content\">\n          <p className=\"error-message\">{result.error || 'Unknown error occurred'}</p>\n          \n          <div className=\"error-actions\">\n            <button className=\"retry-button\" onClick={onRetry}>\n              <span className=\"button-icon\">üîÑ</span>\n              Retry Processing\n            </button>\n            <button className=\"reset-button\" onClick={onReset}>\n              <span className=\"button-icon\">üè†</span>\n              Start Over\n            </button>\n          </div>\n        </div>\n        \n        <div className=\"troubleshooting\">\n          <h3>üí° Troubleshooting Tips:</h3>\n          <ul>\n            <li>Ensure audio and video files are not corrupted</li>\n            <li>Check that file paths are accessible</li>\n            <li>Verify sufficient disk space for processing</li>\n            <li>Try with shorter duration content (under 60 seconds)</li>\n          </ul>\n        </div>\n      </div>\n    );\n  }\n  \n  const processingData = result.result;\n  const summary = processingData.summary;\n  const patterns = processingData.matchingResult?.patterns || {};\n  \n  /**\n   * QA„É°„Éà„É™„ÇØ„Çπ„ÇíÂèñÂæó\n   */\n  const getQAMetrics = (): QAMetrics => {\n    const qaReport = processingData.qaReport;\n    if (!qaReport) {\n      return {\n        aggregateConfidence: summary?.aggregateConfidence || 0,\n        musicSync: 0.8,\n        visualFlow: 0.7,\n        thirtyPercentCompliance: 0.9,\n        overallScore: qaReport?.overallScore || 0.8,\n      };\n    }\n    \n    return {\n      aggregateConfidence: summary?.aggregateConfidence || 0,\n      musicSync: 0.8, // QA„É¨„Éù„Éº„Éà„Åã„ÇâÂèñÂæó\n      visualFlow: 0.7,\n      thirtyPercentCompliance: 0.9,\n      overallScore: qaReport.overallScore,\n    };\n  };\n  \n  /**\n   * „Éë„Çø„Éº„É≥„ÅÆË©≥Á¥∞„ÇíÂèñÂæó\n   */\n  const getPatternDetails = (patternName: string) => {\n    const pattern = patterns[patternName];\n    if (!pattern) return null;\n    \n    return {\n      name: patternName,\n      confidence: pattern.evaluation?.aggregateConfidence || 0,\n      decisions: pattern.decisions?.length || 0,\n      musicalAlignment: pattern.evaluation?.musicalAlignment || 0,\n      visualFlow: pattern.evaluation?.visualFlow || 0,\n      transitionQuality: pattern.evaluation?.transitionQuality || 0,\n    };\n  };\n  \n  /**\n   * „Éï„Ç°„Ç§„É´„Ç®„ÇØ„Çπ„Éù„Éº„Éà\n   */\n  const handleExport = async () => {\n    try {\n      setIsExporting(true);\n      setExportProgress(0);\n      \n      // „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂÖà„ÇíÈÅ∏Êäû\n      const result = await window.electronAPI.dialog.selectDirectory(\n        'Select Export Directory'\n      );\n      \n      if (result.canceled || !result.filePaths?.[0]) {\n        setIsExporting(false);\n        return;\n      }\n      \n      const exportDir = result.filePaths[0];\n      \n      // „Ç®„ÇØ„Çπ„Éù„Éº„ÉàÈÄ≤Êçó„Çí„Ç∑„Éü„É•„É¨„Éº„Éà\n      const files = [\n        { name: 'edit_result.xml', delay: 1000 },\n        { name: 'explain.json', delay: 800 },\n        { name: 'qa_report.json', delay: 600 },\n        { name: 'summary.txt', delay: 400 },\n      ];\n      \n      for (let i = 0; i < files.length; i++) {\n        await new Promise(resolve => setTimeout(resolve, files[i].delay));\n        setExportProgress(((i + 1) / files.length) * 100);\n      }\n      \n      // ÂÆüÈöõ„ÅÆ„Ç®„ÇØ„Çπ„Éù„Éº„ÉàÂá¶ÁêÜÔºàÁµêÊûú„Éï„Ç°„Ç§„É´„ÅÆ„Ç≥„Éî„ÉºÔºâ\n      if (processingData.outputs) {\n        // XML„Éï„Ç°„Ç§„É´„Çí„Ç≥„Éî„Éº\n        if (processingData.outputs.xml) {\n          const xmlContent = await window.electronAPI.fs.readFile(processingData.outputs.xml);\n          if (xmlContent.success) {\n            await window.electronAPI.fs.writeFile(\n              `${exportDir}/edit_result.xml`,\n              xmlContent.content || ''\n            );\n          }\n        }\n        \n        // explain.json„Çí„Ç≥„Éî„Éº\n        if (processingData.outputs.explain) {\n          const explainContent = await window.electronAPI.fs.readFile(processingData.outputs.explain);\n          if (explainContent.success) {\n            await window.electronAPI.fs.writeFile(\n              `${exportDir}/explain.json`,\n              explainContent.content || ''\n            );\n          }\n        }\n        \n        // QA„É¨„Éù„Éº„Éà„Çí„Ç≥„Éî„Éº\n        if (processingData.outputs.qaReport) {\n          const qaContent = await window.electronAPI.fs.readFile(processingData.outputs.qaReport);\n          if (qaContent.success) {\n            await window.electronAPI.fs.writeFile(\n              `${exportDir}/qa_report.json`,\n              qaContent.content || ''\n            );\n          }\n        }\n      }\n      \n      // „Çµ„Éû„É™„Éº„Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê\n      const summaryText = createSummaryText();\n      await window.electronAPI.fs.writeFile(\n        `${exportDir}/summary.txt`,\n        summaryText\n      );\n      \n      alert(`Export completed successfully!\\nFiles saved to: ${exportDir}`);\n      \n    } catch (error) {\n      console.error('Export failed:', error);\n      alert(`Export failed: ${error}`);\n    } finally {\n      setIsExporting(false);\n      setExportProgress(0);\n    }\n  };\n  \n  /**\n   * „Çµ„Éû„É™„Éº„ÉÜ„Ç≠„Çπ„Éà„Çí‰ΩúÊàê\n   */\n  const createSummaryText = (): string => {\n    const qaMetrics = getQAMetrics();\n    \n    return `AutoEditTATE Processing Summary\n===============================\n\nProcessing Time: ${(processingData.processingTime / 1000).toFixed(1)}s\nInput Materials: ${summary?.inputMaterials || 0}\nTotal Decisions: ${summary?.totalDecisions || 0}\nRecommended Pattern: ${summary?.recommendedPattern || 'N/A'}\n\nQuality Metrics:\n- Aggregate Confidence: ${(qaMetrics.aggregateConfidence * 100).toFixed(1)}%\n- Music Sync: ${(qaMetrics.musicSync * 100).toFixed(1)}%\n- Visual Flow: ${(qaMetrics.visualFlow * 100).toFixed(1)}%\n- 30% Rule Compliance: ${(qaMetrics.thirtyPercentCompliance * 100).toFixed(1)}%\n- Overall QA Score: ${(qaMetrics.overallScore * 100).toFixed(1)}%\n\nQA Status: ${summary?.qaStatus || 'N/A'}\n\nGenerated Files:\n- edit_result.xml: Premiere Pro timeline\n- explain.json: Detailed decision explanations\n- qa_report.json: Quality assurance report\n- summary.txt: This summary file\n\nGenerated by AutoEditTATE v1.0.0\n${new Date().toISOString()}`;\n  };\n  \n  /**\n   * „Çπ„Ç≥„Ç¢„ÅÆËâ≤„ÇíÂèñÂæó\n   */\n  const getScoreColor = (score: number): string => {\n    if (score >= 0.88) return '#4CAF50'; // Green\n    if (score >= 0.7) return '#FF9800';  // Orange\n    return '#F44336'; // Red\n  };\n  \n  /**\n   * „Éë„Çø„Éº„É≥Âêç„ÇíÊï¥ÂΩ¢\n   */\n  const formatPatternName = (name: string): string => {\n    switch (name) {\n      case 'dynamic_cut': return 'Dynamic Cut';\n      case 'narrative_flow': return 'Narrative Flow';\n      case 'hybrid_balance': return 'Hybrid Balance';\n      default: return name.replace('_', ' ').replace(/\\b\\w/g, l => l.toUpperCase());\n    }\n  };\n  \n  const qaMetrics = getQAMetrics();\n  const qualityPassed = qaMetrics.aggregateConfidence >= 0.88;\n  \n  return (\n    <div className=\"results-view success\">\n      {/* „Éò„ÉÉ„ÉÄ„Éº */}\n      <div className=\"results-header\">\n        <div className=\"success-indicator\">\n          <span className=\"success-icon\">‚úÖ</span>\n          <div className=\"success-text\">\n            <h2>Processing Complete!</h2>\n            <p>AutoEditTATE has successfully generated your edit patterns.</p>\n          </div>\n        </div>\n        \n        <div className=\"processing-stats\">\n          <div className=\"stat\">\n            <span className=\"stat-value\">{(processingData.processingTime / 1000).toFixed(1)}s</span>\n            <span className=\"stat-label\">Processing Time</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-value\">{summary?.totalDecisions || 0}</span>\n            <span className=\"stat-label\">Decisions Made</span>\n          </div>\n          <div className=\"stat\">\n            <span className=\"stat-value\" style={{ color: getScoreColor(qaMetrics.aggregateConfidence) }}>\n              {(qaMetrics.aggregateConfidence * 100).toFixed(1)}%\n            </span>\n            <span className=\"stat-label\">Confidence</span>\n          </div>\n        </div>\n      </div>\n      \n      {/* ÂìÅË≥™„É°„Éà„É™„ÇØ„Çπ */}\n      <div className=\"quality-metrics\">\n        <h3>Quality Assessment</h3>\n        <div className={`quality-status ${qualityPassed ? 'passed' : 'warning'}`}>\n          <span className=\"status-icon\">{qualityPassed ? 'üü¢' : 'üü°'}</span>\n          <span className=\"status-text\">\n            {qualityPassed ? 'Quality Standard: PASSED' : 'Quality Standard: NEEDS REVIEW'}\n          </span>\n        </div>\n        \n        <div className=\"metrics-grid\">\n          <div className=\"metric\">\n            <span className=\"metric-label\">Aggregate Confidence</span>\n            <div className=\"metric-bar\">\n              <div \n                className=\"metric-fill\"\n                style={{ \n                  width: `${qaMetrics.aggregateConfidence * 100}%`,\n                  backgroundColor: getScoreColor(qaMetrics.aggregateConfidence)\n                }}\n              />\n            </div>\n            <span className=\"metric-value\">{(qaMetrics.aggregateConfidence * 100).toFixed(1)}%</span>\n          </div>\n          \n          <div className=\"metric\">\n            <span className=\"metric-label\">Music Sync</span>\n            <div className=\"metric-bar\">\n              <div \n                className=\"metric-fill\"\n                style={{ \n                  width: `${qaMetrics.musicSync * 100}%`,\n                  backgroundColor: getScoreColor(qaMetrics.musicSync)\n                }}\n              />\n            </div>\n            <span className=\"metric-value\">{(qaMetrics.musicSync * 100).toFixed(1)}%</span>\n          </div>\n          \n          <div className=\"metric\">\n            <span className=\"metric-label\">30% Rule Compliance</span>\n            <div className=\"metric-bar\">\n              <div \n                className=\"metric-fill\"\n                style={{ \n                  width: `${qaMetrics.thirtyPercentCompliance * 100}%`,\n                  backgroundColor: getScoreColor(qaMetrics.thirtyPercentCompliance)\n                }}\n              />\n            </div>\n            <span className=\"metric-value\">{(qaMetrics.thirtyPercentCompliance * 100).toFixed(1)}%</span>\n          </div>\n        </div>\n      </div>\n      \n      {/* „Éë„Çø„Éº„É≥ÈÅ∏Êäû */}\n      <div className=\"pattern-selection\">\n        <h3>Generated Edit Patterns</h3>\n        <p>AutoEditTATE has generated three different editing approaches for your content:</p>\n        \n        <div className=\"pattern-tabs\">\n          {Object.keys(patterns).map(patternName => {\n            const details = getPatternDetails(patternName);\n            const isRecommended = patternName === summary?.recommendedPattern;\n            \n            return (\n              <button\n                key={patternName}\n                className={`pattern-tab ${\n                  selectedPattern === patternName ? 'active' : ''\n                } ${isRecommended ? 'recommended' : ''}`}\n                onClick={() => setSelectedPattern(patternName)}\n              >\n                <div className=\"pattern-info\">\n                  <span className=\"pattern-name\">\n                    {formatPatternName(patternName)}\n                    {isRecommended && <span className=\"recommended-badge\">‚òÖ Recommended</span>}\n                  </span>\n                  {details && (\n                    <span className=\"pattern-confidence\">\n                      {(details.confidence * 100).toFixed(1)}% confidence\n                    </span>\n                  )}\n                </div>\n              </button>\n            );\n          })}\n        </div>\n        \n        {/* ÈÅ∏Êäû„Åï„Çå„Åü„Éë„Çø„Éº„É≥„ÅÆË©≥Á¥∞ */}\n        {selectedPattern && (\n          <div className=\"pattern-details\">\n            <h4>{formatPatternName(selectedPattern)} Pattern</h4>\n            {(() => {\n              const details = getPatternDetails(selectedPattern);\n              if (!details) return <p>Pattern details not available.</p>;\n              \n              return (\n                <div className=\"pattern-stats\">\n                  <div className=\"pattern-stat\">\n                    <span className=\"stat-label\">Decisions:</span>\n                    <span className=\"stat-value\">{details.decisions}</span>\n                  </div>\n                  <div className=\"pattern-stat\">\n                    <span className=\"stat-label\">Musical Alignment:</span>\n                    <span className=\"stat-value\">{(details.musicalAlignment * 100).toFixed(1)}%</span>\n                  </div>\n                  <div className=\"pattern-stat\">\n                    <span className=\"stat-label\">Visual Flow:</span>\n                    <span className=\"stat-value\">{(details.visualFlow * 100).toFixed(1)}%</span>\n                  </div>\n                  <div className=\"pattern-stat\">\n                    <span className=\"stat-label\">Transition Quality:</span>\n                    <span className=\"stat-value\">{(details.transitionQuality * 100).toFixed(1)}%</span>\n                  </div>\n                </div>\n              );\n            })()}\n          </div>\n        )}\n      </div>\n      \n      {/* „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ */}\n      <div className=\"export-section\">\n        <h3>Export Results</h3>\n        <p>Download your editing results in multiple formats:</p>\n        \n        {isExporting ? (\n          <div className=\"export-progress\">\n            <div className=\"progress-info\">\n              <span>Exporting files...</span>\n              <span>{Math.round(exportProgress)}%</span>\n            </div>\n            <div className=\"progress-bar\">\n              <div \n                className=\"progress-fill\"\n                style={{ width: `${exportProgress}%` }}\n              />\n            </div>\n          </div>\n        ) : (\n          <div className=\"export-options\">\n            <div className=\"export-files\">\n              <div className=\"file-item\">\n                <span className=\"file-icon\">üìÑ</span>\n                <div className=\"file-info\">\n                  <span className=\"file-name\">edit_result.xml</span>\n                  <span className=\"file-desc\">Premiere Pro timeline</span>\n                </div>\n              </div>\n              <div className=\"file-item\">\n                <span className=\"file-icon\">üìã</span>\n                <div className=\"file-info\">\n                  <span className=\"file-name\">explain.json</span>\n                  <span className=\"file-desc\">Detailed decision explanations</span>\n                </div>\n              </div>\n              <div className=\"file-item\">\n                <span className=\"file-icon\">üîç</span>\n                <div className=\"file-info\">\n                  <span className=\"file-name\">qa_report.json</span>\n                  <span className=\"file-desc\">Quality assurance report</span>\n                </div>\n              </div>\n              <div className=\"file-item\">\n                <span className=\"file-icon\">üìä</span>\n                <div className=\"file-info\">\n                  <span className=\"file-name\">summary.txt</span>\n                  <span className=\"file-desc\">Processing summary</span>\n                </div>\n              </div>\n            </div>\n            \n            <button \n              className=\"export-button\"\n              onClick={handleExport}\n            >\n              <span className=\"button-icon\">üì•</span>\n              Export All Files\n            </button>\n          </div>\n        )}\n      </div>\n      \n      {/* „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ */}\n      <div className=\"results-actions\">\n        <button className=\"secondary-button\" onClick={onReset}>\n          <span className=\"button-icon\">üè†</span>\n          Process New Content\n        </button>\n        \n        <button className=\"secondary-button\" onClick={onRetry}>\n          <span className=\"button-icon\">üîÑ</span>\n          Reprocess with Different Settings\n        </button>\n      </div>\n    </div>\n  );\n}