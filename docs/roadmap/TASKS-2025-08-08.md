# Implementation Plan (20-step Delivery Roadmap)

Status: Accepted  
Owner: Engineering  
Last Updated: 2025-08-07

This is the canonical, implementation-ready plan derived from the current ADRs and archive docs. It is ordered to minimize rework, de-risk early, and keep feedback loops short. Each step includes concrete deliverables, acceptance criteria, and notes.

Index
- 1. Repo foundations and governance
- 2. Solidify architecture in ADRs and sync with backlog
- 3. Domain model and interfaces
- 4. Platform and i18n baseline
- 5. Error handling framework
- 6. Monorepo scaffolding
- 7. Infrastructure adapters (Hexagonal)
- 8. Configuration and secrets
- 9. Observability baseline
- 10. Web application shell
- 11. HTTP API service
- 12. CLI utility for batch ops
- 13. Data migration and seed
- 14. Security hardening
- 15. Performance and SLIs/SLOs
- 16. Feature walking skeleton
- 17. Documentation and developer experience
- 18. Release, environments, deployment
- 19. Monitoring and runbooks
- 20. Backlog grooming and next iterations

---

1) Repo foundations and governance
- Deliverables:
  - ローカルQAスイート (lint, test, typecheck, build)
  - .editorconfig
  - CODEOWNERS, CONTRIBUTING.md, SECURITY.md
  - docs/adr/ADR-000-template.md
- Acceptance Criteria:
  - QAスイートがローカルで実行可能; エラー時は停止
  - Pre-commit hooks run lint/format
- Notes:
  - Node LTSを使用; conventional commitsを推奨

2) Solidify architecture in ADRs and sync with backlog
- Deliverables:
  - Update docs/adr/ADR-001-architecture.md and docs/adr/ADR-002-architecture-design.md with final module boundaries, data flow, trust zones
  - Link ADR decisions to issues/epics in tracker
- Acceptance Criteria:
  - All core decisions are Status: Accepted and Consequences filled
- Notes:
  - Add diagrams: C4 level 2, sequence diagrams for critical flows

3) Define domain model and interfaces
- Deliverables:
  - packages/domain/src/entities/*.ts
  - packages/domain/src/value-objects/*.ts
  - packages/domain/src/services/*.ts
  - packages/domain/src/ports/*.ts (hexagonal ports)
  - packages/domain/tsconfig.json
- Acceptance Criteria:
  - ≥90% unit test coverage in domain
  - No external libs in domain (except types/assert libs)
- Notes:
  - Ports for persistence, i18n formatting, external APIs

4) Platform and i18n strategy baseline
- Deliverables:
  - Promote docs/archive/platform-and-i18n.md to ADR if finalized
  - packages/i18n/src/index.ts abstraction with ICU support
  - docs/locale/STYLEGUIDE.md with message format guidelines
- Acceptance Criteria:
  - i18n exposes formatMessage(), getPluralRule(), loadBundles()
  - Demo bundles for ja-JP and en-US
- Notes:
  - Prefer ICU messageformat; async bundle loading contract

5) Error handling framework
- Deliverables:
  - Convert docs/archive/error-cookbook.md to ADR (taxonomy, codes)
  - packages/errors/src/AppError.ts (code, cause, metadata, telemetry hint)
  - packages/errors/src/httpMapper.ts and packages/errors/src/uiMapper.ts
- Acceptance Criteria:
  - All layers throw AppError subclasses
  - HTTP/UI mapping covered by tests
- Notes:
  - RFC 7807 for HTTP; stable error codes catalog

6) Monorepo scaffolding
- Deliverables:
  - package.json workspaces
  - pnpm-workspace.yaml (or yarn workspaces)
  - tsconfig.base.json
  - packages/*: domain, i18n, errors, infra, app-web, app-cli, api, config, obs
- Acceptance Criteria:
  - pnpm -r build builds all; path aliases resolve across packages
- Notes:
  - Changesets for versioning (.changeset/config.json)

7) Infrastructure adapters (Hexagonal)
- Deliverables:
  - packages/infra/src/db/PrismaContentRepo.ts implements domain ContentRepo
  - packages/infra/prisma/schema.prisma
  - packages/infra/src/i18n/BundleLoaderFs.ts
- Acceptance Criteria:
  - Adapters conform to domain ports and pass contract tests
- Notes:
  - Use pact-like contract tests or jest interface tests

8) Configuration and secrets
- Deliverables:
  - packages/config/src/index.ts typed config loader (zod)
  - .env.example with required vars; runtime config mapping
- Acceptance Criteria:
  - Process fails fast on invalid/missing config
- Notes:
  - Support NODE_ENV profiles; keep domain pure

9) Observability baseline
- Deliverables:
  - packages/obs/src/logger.ts (pino or equivalent structured logs)
  - packages/obs/src/tracing.ts (OpenTelemetry setup)
- Acceptance Criteria:
  - Correlation IDs propagate across HTTP and jobs
- Notes:
  - Error mapper enriches logs with error metadata

10) Web application shell
- Deliverables:
  - packages/app-web/next.config.mjs
  - packages/app-web/src/app/(pages)/page.tsx
  - packages/app-web/src/providers/I18nProvider.tsx
  - packages/app-web/src/lib/errorBoundary.tsx
- Acceptance Criteria:
  - SSR/SSG configured; locale routing; error boundary renders friendly messages
- Notes:
  - Edge-safe if using RSC; avoid Node-only APIs client-side

11) HTTP API service
- Deliverables:
  - packages/api/src/server.ts (Fastify/Express)
  - packages/api/src/routes/content.ts
  - packages/api/src/middleware/error.ts (AppError -> RFC7807)
  - packages/api/openapi.yaml
- Acceptance Criteria:
  - Contract tests against OpenAPI; E2E smoke with supertest
- Notes:
  - Versioned routes; request validation via zod/openapi-generated types

12) CLI utility for batch operations
- Deliverables:
  - packages/app-cli/src/index.ts
  - Commands: import, i18n-verify, sync
- Acceptance Criteria:
  - Runs with pnpm tsx; handles AppError with proper exit codes
- Notes:
  - Common logger/config/errors reused

13) Data migration and seed
- Deliverables:
  - packages/infra/prisma/migrations/*
  - packages/infra/src/seeds/seed.ts
- Acceptance Criteria:
  - Fresh environment can be stood up via single script
- Notes:
  - Idempotent seeds; fixture data per locale

14) Security hardening
- Deliverables:
  - docs/security/STRIDE.md (threat model)
  - HTTP security headers middleware and CSRF strategy doc
  - Dependency policy in CI (audit/OSS review)
- Acceptance Criteria:
  - Baseline checks pass; secure headers present; secrets not logged
- Notes:
  - Define secret handling and rotation guidance

15) Performance and SLIs/SLOs
- Deliverables:
  - docs/ops/slis-slos.md
  - perf/k6/basic.js and Lighthouse budgets for web
- Acceptance Criteria:
  - Budget gates in CI; baseline k6 test passes locally
- Notes:
  - Track latency, error rate, throughput per SLI

16) Feature vertical slice (walking skeleton)
- Deliverables:
  - End-to-end flow: create content -> store -> read -> render localized
  - packages/app-web/e2e/content.spec.ts (Cypress/Playwright)
- Acceptance Criteria:
  - Test runs green locally and in CI; telemetry visible through stack
- Notes:
  - This validates the architecture end-to-end

17) Documentation and developer experience
- Deliverables:
  - Update docs/archive/INDEX.md index
  - README.md with quickstart, architecture map, task graphs
  - Decision log pointers from code to ADRs
- Acceptance Criteria:
  - New dev can setup and run app in <15 minutes
- Notes:
  - Include local dev scripts and common troubleshooting

18) Release, environments, and deployment
- Deliverables:
  - packages/api/Dockerfile and packages/app-web/Dockerfile
  - deploy/* (K8s/Render/Fly configs)
  - deploy/scripts/deploy.sh
- Acceptance Criteria:
  - Staging deploy from main; versioned artifacts; rollback plan
- Notes:
  - Tagging strategy and environment promotion documented

19) Monitoring and runbooks
- Deliverables:
  - docs/ops/runbooks/*.md (e.g., content-errors.md)
  - Alert policies tied to SLOs
- Acceptance Criteria:
  - On-call can triage top 5 failure modes using runbooks
- Notes:
  - Include dashboards and log queries references

20) Backlog grooming and next iterations
- Deliverables:
  - Issue templates, labels, milestones
  - Groomed backlog mapped to architecture capabilities
- Acceptance Criteria:
  - Two iterations of well-scoped issues with DoD linked
- Notes:
  - Keep plan and ADRs synchronized as decisions evolve

Change Management
- This plan is living documentation. Significant changes require an ADR update and a PR linking to the impacted steps here.
- Keep “Last Updated” current when modifying scope or acceptance criteria.

Links
- Architecture ADRs: docs/adr/ADR-001-architecture.md, docs/adr/ADR-002-architecture-design.md
- Archive references: docs/archive/platform-and-i18n.md, docs/archive/error-cookbook.md, docs/archive/INDEX.md