# æ™‚é–“ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆæ›¸
Version: 1.0
Date: 2025-08-08
Status: Draft
Type: System Design

## æ¦‚è¦
ç¸¦å‹•ç”»ï¼ˆMV/SNSï¼‰ã®æ™‚é–“è»¸ã‚’è¤‡æ•°ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«åˆ†å‰²ã—ã€å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°ã¨å­¦ç¿’ã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã€‚

---

## 1. ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå®šç¾©

### 1.1 åŸºæœ¬ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ§‹é€ ï¼ˆ60ç§’å‹•ç”»ï¼‰
```yaml
segments:
  hook:       # 0-3ç§’ï¼ˆæœ€é‡è¦ï¼‰
    role: "è¦–è´è€…ã‚’å¼•ãè¾¼ã‚€"
    importance: critical
    
  development: # 3-10ç§’
    role: "èˆˆå‘³ã‚’ç¶­æŒãƒ»å±•é–‹"
    importance: high
    
  main:       # 10-30ç§’
    role: "ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„"
    importance: high
    
  climax:     # 30-50ç§’
    role: "ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹/ã‚µãƒ“"
    importance: critical
    
  outro:      # 50-60ç§’
    role: "ç· ã‚ãƒ»ãƒ«ãƒ¼ãƒ—èª˜å°"
    importance: medium
```

### 1.2 éŸ³æ¥½æ§‹é€ ã¨ã®é€£å‹•
```yaml
music_segments:
  intro:    { start: 0, end: detect() }
  verse:    { start: detect(), end: detect() }
  pre_chorus: { start: detect(), end: detect() }
  chorus:   { start: detect(), end: detect() }
  bridge:   { start: detect(), end: detect() }
  outro:    { start: detect(), end: 60 }
```

---

## 2. ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°

### 2.1 ç‹¬ç«‹ã‚¹ã‚³ã‚¢ç®¡ç†
```typescript
interface SegmentScore {
  segment_id: string;
  time_range: [number, number];  // [start, end] in seconds
  scores: {
    sync: number;      // éŸ³æ¥½åŒæœŸ
    visual: number;    // æ˜ åƒå“è³ª
    semantic: number;  // æ„å‘³çš„ä¸€è²«æ€§
    stability: number; // ç·¨é›†å®‰å®šæ€§
    energy: number;    // ã‚¨ãƒãƒ«ã‚®ãƒ¼ãƒ¬ãƒ™ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰
  };
  confidence: number;  // å­¦ç¿’ç¢ºä¿¡åº¦
}

// å…¨ä½“ã‚¹ã‚³ã‚¢ã¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®é‡ã¿ä»˜ãå¹³å‡
interface OverallScore {
  segments: SegmentScore[];
  weighted_average: number;
  segment_weights: {
    hook: 0.25,      // æœ€é‡è¦
    development: 0.15,
    main: 0.20,
    climax: 0.30,    // æœ€é‡è¦
    outro: 0.10
  };
}
```

### 2.2 ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹æœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```yaml
hook_segment (0-3ç§’):
  specific_params:
    - first_frame_impact: 0.0-1.0
    - cut_density: 1.5x baseline
    - face_priority: 0.9
    - text_overlay: true
    - motion_intensity: high
  
climax_segment (30-50ç§’):
  specific_params:
    - beat_sync_precision: strict
    - emotional_peak: true
    - cut_acceleration: 1.3x
    - highlight_shots: priority
    - energy_maintenance: high
```

---

## 3. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è§£æã®ç²¾å¯†åŒ–

### 3.1 ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```python
def analyze_feedback(user_feedback: str, selected_pattern: str):
    # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹å®š
    segment_keywords = {
        'hook': ['å‡ºã ã—', 'æœ€åˆ', 'é–‹å§‹', 'ã¤ã‹ã¿', '3ç§’'],
        'climax': ['ã‚µãƒ“', 'ç››ã‚Šä¸ŠãŒã‚Š', 'ã‚¯ãƒ©ã‚¤ãƒãƒƒã‚¯ã‚¹', 'æœ€é«˜'],
        'outro': ['çµ‚ã‚ã‚Š', 'ãƒ©ã‚¹ãƒˆ', 'ç· ã‚', 'ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°'],
        'main': ['ä¸­ç›¤', 'ãƒ¡ã‚¤ãƒ³', 'æœ¬ç·¨']
    }
    
    # éŸ³æ¥½æ§‹é€ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
    music_keywords = {
        'chorus': ['ã‚µãƒ“', 'ã‚³ãƒ¼ãƒ©ã‚¹'],
        'verse': ['Aãƒ¡ãƒ­', 'ãƒãƒ¼ã‚¹'],
        'bridge': ['ãƒ–ãƒªãƒƒã‚¸', 'å¤§ã‚µãƒ“']
    }
    
    identified_segments = detect_segments(feedback, keywords)
    return apply_adjustments(identified_segments)
```

### 3.2 ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ä¾‹ã¨è§£æ
```yaml
ä¾‹1: "ã‚µãƒ“ã®ç››ã‚Šä¸ŠãŒã‚ŠãŒæœ€é«˜ã§ã—ãŸ"
è§£æçµæœ:
  target_segment: climax (30-50ç§’)
  music_segment: chorus
  adjustments:
    climax.sync: +0.15
    climax.energy: +0.20
    climax.cut_density: +0.10
  other_segments: no_change

ä¾‹2: "å‡ºã ã—ãŒå¼±ã„æ°—ãŒã™ã‚‹"
è§£æçµæœ:
  target_segment: hook (0-3ç§’)
  adjustments:
    hook.energy: +0.25
    hook.first_frame_impact: +0.30
    hook.cut_density: +0.20
  other_segments: no_change

ä¾‹3: "å…¨ä½“çš„ã«ã„ã„ã‘ã©ã€ã‚µãƒ“å‰ãŒãƒ€ãƒ¬ã‚‹"
è§£æçµæœ:
  target_segment: development (20-30ç§’)
  adjustments:
    development.energy: +0.15
    development.cut_density: +0.10
  maintain_segments: [hook, climax]
```

---

## 4. LLMç®¡ç†ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰ˆï¼‰

```markdown
# USER_PREFERENCE_PROFILE_SEGMENTED.md
Generated by: AutoEditTATE Temporal Learning System
Last Updated: 2025-08-08

## User: @user_12345
Platform: TikTok (Primary), Instagram Reels (Secondary)

## Segment Performance Matrix

### Current Learning State
| Segment | Time | Confidence | Last Update | Trend |
|---------|------|------------|-------------|-------|
| Hook | 0-3s | 85% | 2025-08-08 | â†‘ Improving |
| Development | 3-10s | 72% | 2025-08-07 | â†’ Stable |
| Main | 10-30s | 78% | 2025-08-08 | â†’ Stable |
| Climax | 30-50s | 92% | 2025-08-08 | âœ“ Optimized |
| Outro | 50-60s | 65% | 2025-08-06 | ? Learning |

## Detailed Segment Profiles

### ğŸ¬ Hook (0-3ç§’)
**Performance**: â­â­â­â­â˜†
```json
{
  "sync": 0.45,
  "visual": 0.82,
  "energy": 0.75,
  "first_frame_impact": 0.88,
  "preferred_shots": ["close_up_face", "high_motion"],
  "avg_shot_length": 0.5
}
```
**User Feedback History**:
- "ã‚‚ã£ã¨ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆãŒæ¬²ã—ã„" â†’ energy +0.2
- "é¡”ã‹ã‚‰å§‹ã¾ã‚‹ã®ãŒã„ã„" â†’ face_priority +0.3

### ğŸµ Climax (30-50ç§’)
**Performance**: â­â­â­â­â­
```json
{
  "sync": 0.92,
  "visual": 0.78,
  "energy": 0.95,
  "beat_precision": 0.98,
  "preferred_pattern": "dynamic_cut",
  "cut_density": 1.8
}
```
**User Feedback History**:
- "ã‚µãƒ“ã®ç››ã‚Šä¸ŠãŒã‚ŠãŒæœ€é«˜" â†’ sync +0.15
- "ãƒ“ãƒ¼ãƒˆã¨ã®åŒæœŸãŒå®Œç’§" â†’ beat_precision +0.1

## Music Structure Mapping
```yaml
detected_structure:
  intro: [0, 3]
  verse1: [3, 15]
  pre_chorus: [15, 23]
  chorus1: [23, 38]
  bridge: [38, 46]
  chorus2: [46, 58]
  outro: [58, 60]

user_preference_per_section:
  chorus: { energy: high, cuts: frequent, sync: strict }
  verse: { energy: medium, cuts: moderate, focus: narrative }
  bridge: { energy: building, cuts: accelerating }
```

## Segment Correlation Analysis
- Hook â†’ Development: Smooth energy transition preferred
- Main â†’ Climax: Sharp energy increase works well
- Climax â†’ Outro: Gradual decrease with loop setup

## Next Generation Strategy
1. **Hook**: Increase first frame impact by 15%
2. **Development**: Maintain current parameters
3. **Main**: Test slight energy increase (+0.05)
4. **Climax**: Lock current settings (optimal)
5. **Outro**: Experiment with loop-friendly endings
```

---

## 5. å®Ÿè£…ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 5.1 ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè§£æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
```typescript
class SegmentAnalyzer {
  // éŸ³æ¥½æ§‹é€ æ¤œå‡º
  async detectMusicStructure(audio: AudioBuffer): Promise<MusicSegments> {
    const beats = await detectBeats(audio);
    const structure = await analyzeStructure(audio);
    return mapToSegments(structure, beats);
  }
  
  // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨ã®ç‰¹å¾´æŠ½å‡º
  extractSegmentFeatures(video: VideoFrames, segment: TimeRange): SegmentFeatures {
    const frames = video.slice(segment.start, segment.end);
    return {
      avgShotLength: calculateAvgShot(frames),
      cutDensity: countCuts(frames) / segment.duration,
      faceRatio: detectFaces(frames),
      motionIntensity: analyzeMotion(frames)
    };
  }
  
  // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ã‚¹ã‚³ã‚¢è¨ˆç®—
  scoreSegment(features: SegmentFeatures, preferences: UserPreferences): SegmentScore {
    return {
      sync: calculateSyncScore(features, preferences),
      visual: calculateVisualScore(features, preferences),
      energy: calculateEnergyScore(features, preferences),
      // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹æœ‰ã®é‡ã¿ä»˜ã‘
      weighted: applySegmentWeight(scores, segment.type)
    };
  }
}
```

### 5.2 å­¦ç¿’æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯
```typescript
class SegmentLearningEngine {
  updateSegmentPreferences(
    feedback: string,
    selectedPattern: string,
    currentProfile: UserProfile
  ): UpdatedProfile {
    // 1. ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‹ã‚‰ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹å®š
    const targetSegments = this.identifyTargetSegments(feedback);
    
    // 2. å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«å¯¾ã—ã¦èª¿æ•´
    targetSegments.forEach(segment => {
      const adjustment = this.calculateAdjustment(
        feedback,
        segment,
        currentProfile.segments[segment.id]
      );
      
      // 3. ä¿¡é ¼åº¦ã«åŸºã¥ã„ã¦æ›´æ–°é‡ã‚’èª¿æ•´
      const learningRate = this.getLearningRate(
        currentProfile.segments[segment.id].confidence
      );
      
      // 4. ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°
      currentProfile.segments[segment.id] = this.applyUpdate(
        currentProfile.segments[segment.id],
        adjustment,
        learningRate
      );
    });
    
    return currentProfile;
  }
  
  // å­¦ç¿’ç‡ã®å‹•çš„èª¿æ•´
  getLearningRate(confidence: number): number {
    if (confidence < 0.5) return 0.2;  // åˆæœŸã¯å¤§ãã
    if (confidence < 0.8) return 0.1;  // ä¸­æœŸã¯é©åº¦ã«
    return 0.05;  // æˆç†ŸæœŸã¯å¾®èª¿æ•´
  }
}
```

---

## 6. æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 6.1 ç²¾åº¦å‘ä¸Š
```yaml
ç¾çŠ¶:
  - å…¨ä½“ä¸€å¾‹ã®èª¿æ•´
  - ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã®æ›–æ˜§ãªåæ˜ 
  
æ”¹å–„å¾Œ:
  - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ã®ç²¾å¯†èª¿æ•´
  - æ˜ç¢ºãªã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ”¹å–„
  - éŸ³æ¥½æ§‹é€ ã¨ã®æ­£ç¢ºãªé€£å‹•
```

### 6.2 å­¦ç¿’åŠ¹ç‡
```yaml
åæŸé€Ÿåº¦:
  - ç¾çŠ¶: 20-30å›ã§åæŸ
  - æ”¹å–„: 10-15å›ã§ä¸»è¦éƒ¨åˆ†ãŒåæŸ
  
ç†ç”±:
  - å•é¡Œç®‡æ‰€ã‚’ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆæ”¹å–„
  - è‰¯ã„éƒ¨åˆ†ã¯ç¶­æŒ
  - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé–“ã®ç‹¬ç«‹å­¦ç¿’
```

### 6.3 ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“
```yaml
ãƒ¡ãƒªãƒƒãƒˆ:
  - ã‚ˆã‚Šç›´æ„Ÿçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
  - å³åº§ã«æ”¹å–„ã‚’å®Ÿæ„Ÿ
  - éŸ³æ¥½ã®æ§‹é€ ã‚’æ´»ã‹ã—ãŸç·¨é›†
  
ä¾‹:
  "ã‚µãƒ“ã¯ãã®ã¾ã¾ã§ã€å‡ºã ã—ã ã‘æ”¹å–„"
  â†’ æ­£ç¢ºã«æ„å›³ã‚’åæ˜ 
```

---

## 7. å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤æ§‹ç¯‰ï¼ˆ2é€±é–“ï¼‰
- [ ] éŸ³æ¥½æ§‹é€ æ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿè£…
- [ ] ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ†å‰²ãƒ­ã‚¸ãƒƒã‚¯
- [ ] ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåˆ¥ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°

### Phase 2: å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ï¼ˆ2é€±é–“ï¼‰
- [ ] ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è§£æã‚¨ãƒ³ã‚¸ãƒ³
- [ ] ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç‰¹å®šã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- [ ] ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯

### Phase 3: çµ±åˆã¨ãƒ†ã‚¹ãƒˆï¼ˆ1é€±é–“ï¼‰
- [ ] æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®çµ±åˆ
- [ ] A/Bãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

## 8. æŠ€è¡“çš„è€ƒæ…®äº‹é …

### 8.1 ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå¢ƒç•Œã®æ‰±ã„
```yaml
èª²é¡Œ:
  - å³å¯†ãªå¢ƒç•Œ vs è‡ªç„¶ãªæµã‚Œ
  
è§£æ±ºç­–:
  - å¢ƒç•Œå‰å¾Œ1ç§’ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ãƒƒãƒ—
  - é‡ã¿ä»˜ããƒ–ãƒ¬ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
  - ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³è€ƒæ…®
```

### 8.2 éŸ³æ¥½æ§‹é€ ã®è‡ªå‹•æ¤œå‡º
```yaml
æ‰‹æ³•:
  - Essentia MusicExtractor
  - onset detection
  - spectral analysis
  - repetition detection
  
ç²¾åº¦ç›®æ¨™:
  - ã‚µãƒ“æ¤œå‡º: 95%
  - æ§‹é€ å¢ƒç•Œ: Â±0.5ç§’
```

---

## æ›´æ–°å±¥æ­´
| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ |
|------|-----------|----------|
| 2025-08-08 | 1.0 | åˆç‰ˆä½œæˆ |