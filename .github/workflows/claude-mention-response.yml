name: Claude Mention Response

on:
  issue_comment:
    types: [created]
  issues:
    types: [opened]

jobs:
  respond-to-mention:
    runs-on: ubuntu-latest
    if: |
      (github.event_name == 'issue_comment' && contains(github.event.comment.body, '@claude')) ||
      (github.event_name == 'issues' && contains(github.event.issue.body, '@claude'))
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Extract mention context
        id: extract
        run: |
          if [ "${{ github.event_name }}" == "issue_comment" ]; then
            echo "CONTENT=${{ github.event.comment.body }}" >> $GITHUB_OUTPUT
            echo "ISSUE_NUMBER=${{ github.event.issue.number }}" >> $GITHUB_OUTPUT
          else
            echo "CONTENT=${{ github.event.issue.body }}" >> $GITHUB_OUTPUT
            echo "ISSUE_NUMBER=${{ github.event.issue.number }}" >> $GITHUB_OUTPUT
          fi
      
      - name: Generate mention acknowledgment
        id: claude_response
        run: |
          CONTENT="${{ steps.extract.outputs.CONTENT }}"
          
          # Generate response for Claude MAX users (API-free)
          RESPONSE="ğŸ‘‹ Claude MAX ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘è‡ªå‹•å¿œç­”ã‚·ã‚¹ãƒ†ãƒ ãŒèµ·å‹•ã—ã¾ã—ãŸï¼

**ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³å†…å®¹ã‚’ç¢ºèª:**
\`\`\`
$CONTENT
\`\`\`

**æ³¨æ„:** Claude MAXï¼ˆProï¼‰ã‚’ã”åˆ©ç”¨ã®å ´åˆã€ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œçŸ¥ã¨ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ ã®ã¿è¡Œã„ã¾ã™ã€‚
è©³ç´°ãª AI å¿œç­”ã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€Claude.ai ã§ç›´æ¥ãŠç­”ãˆã„ãŸã ãã‹ã€API ã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

**å¯èƒ½ãªæ“ä½œ:**
- âœ… ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³æ¤œçŸ¥ãƒ»é€šçŸ¥
- âœ… è‡ªå‹•ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ   
- â³ è©³ç´°ãªAIå¿œç­”ï¼ˆè¦APIè¨­å®šï¼‰"
          
          # Save response for next step
          echo "RESPONSE<<EOF" >> $GITHUB_OUTPUT
          echo "$RESPONSE" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
      
      - name: Post response to issue
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = ${{ steps.extract.outputs.ISSUE_NUMBER }};
            const response = `${{ steps.claude_response.outputs.RESPONSE }}`;
            
            // Add Claude's response as a comment
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: `ğŸ¤– **Claude Response:**\n\n${response}\n\n---\n*This response was generated automatically via GitHub Actions*`
            });
      
      - name: Add reaction to original comment
        if: github.event_name == 'issue_comment'
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            await github.rest.reactions.createForIssueComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              comment_id: ${{ github.event.comment.id }},
              content: 'rocket'
            });