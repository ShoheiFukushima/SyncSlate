name: Gemini Daily Health Check

# DISABLED - on:
# DISABLED -   schedule:
    # 毎日朝9時（JST）に実行
    - cron: '0 0 * * *'
# DISABLED -   workflow_dispatch:  # 手動実行も可能

jobs:
  daily-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      # package.jsonを読み込み
      - name: Read package.json
        id: package
        run: |
          if [ -f "package.json" ]; then
            echo "content=$(cat package.json | jq -c .)" >> $GITHUB_OUTPUT
          else
            echo "content={}" >> $GITHUB_OUTPUT
          fi
      
      # 最近のコミットを取得
      - name: Get recent commits
        id: commits
        run: |
          echo "recent=$(git log --oneline -n 10)" >> $GITHUB_OUTPUT
      
      # Geminiで健康診断
      - name: Daily health check with Gemini
        id: gemini-check
        uses: google-github-actions/run-gemini@v1
        with:
          api_key: ${{ secrets.GEMINI_API_KEY }}
          model: gemini-1.5-flash
          prompt: |
            プロジェクトの日次健康診断を行います。
            
            package.json:
            ${{ steps.package.outputs.content }}
            
            最近のコミット:
            ${{ steps.commits.outputs.recent }}
            
            以下を日本語でレポートしてください：
            
            ## 📊 本日のステータス
            
            ### 🔄 依存関係チェック
            - 更新が推奨されるパッケージ（メジャーバージョンアップは慎重に）
            - セキュリティアラート
            
            ### 💡 今日の推奨タスク（3つまで）
            - 優先度順に記載
            
            ### ⚡ パフォーマンス改善の提案
            - package.jsonから見える改善点
            
            ### 📝 コード品質
            - 最近のコミットメッセージの品質評価
            - 改善提案
      
      # 結果をサマリーとして保存
      - name: Save summary
        run: |
          echo "# 📋 Daily Health Check Report - $(date +%Y-%m-%d)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.gemini-check.outputs.response }}" >> $GITHUB_STEP_SUMMARY
      
      # Slackやメールに通知する場合はここに追加
      # - name: Send notification
      #   run: echo "Add your notification logic here"